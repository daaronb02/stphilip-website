---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BannerImage from '../../components/BannerImage.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const albums = await getCollection('gallery', ({ data }) => !data.draft);
  return albums.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
---

<BaseLayout title={`${entry.data.title} â€” St. Philip Byzantine Catholic Church`}>
  <BannerImage title="Gallery" subtitle={entry.data.title} />

  <section class="album fade-in-section">
    <div class="container">
      <a href="/gallery/" class="album__back">&larr; All Albums</a>

      <h1 class="album__title">{entry.data.title}</h1>

      <time class="album__date" datetime={entry.data.eventDate.toISOString()}>
        {entry.data.eventDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
      </time>

      <p class="album__description">{entry.data.description}</p>

      <div class="photo-grid">
        {entry.data.photos.map((photo) => (
          <figure class="photo-grid__item">
            <img src={photo.image} alt={photo.alt} class="photo-grid__image" loading="lazy" />
            {photo.caption && (
              <figcaption class="photo-grid__caption">{photo.caption}</figcaption>
            )}
          </figure>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .album {
    padding-block: var(--space-2xl);
  }

  .album__back {
    display: inline-block;
    color: var(--theme-accent);
    text-decoration: none;
    font-size: 0.9375rem;
    margin-bottom: var(--space-lg);
    transition: opacity var(--transition-fast);
  }

  .album__back:hover {
    opacity: 0.7;
  }

  .album__title {
    color: var(--color-heading);
    margin-bottom: var(--space-sm);
  }

  .album__date {
    display: block;
    color: var(--color-text-muted);
    font-size: 0.9375rem;
    margin-bottom: var(--space-md);
  }

  .album__description {
    color: var(--color-text);
    line-height: 1.6;
    margin-bottom: var(--space-xl);
  }

  .photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-md);
  }

  .photo-grid__item {
    margin: 0;
  }

  .photo-grid__image {
    width: 100%;
    height: 240px;
    object-fit: cover;
    border-radius: var(--radius-md);
    display: block;
  }

  .photo-grid__caption {
    padding-top: var(--space-xs);
    font-size: 0.875rem;
    color: var(--color-text-muted);
    text-align: center;
  }
</style>
